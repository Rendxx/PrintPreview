{"version":3,"sources":["PrintPreview.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"PrintPreview.js","sourcesContent":["/************************************************ \r\nPrint Manager\r\nCopyright (c) 2015 Dongxu Ren  http://www.rendxx.com/\r\n\r\nLicense: MIT (http://www.opensource.org/licenses/mit-license.php)\r\nVersion: 1.0\r\nUpdate: 2015-08-26\r\n\r\nDescription:\r\n   Print given dom (html string + css json)\r\n   Will call browser print function to do the job\r\n   \r\nCompatibility:\r\n    Chrome; Fire Fox; Safari; Edge; IE 9-11; IE 7,8;\r\n\r\nAPI:\r\n    $$.print.preview(container, htmlStr, cssJson)\r\n        * Render a preview of print content in given dom element\r\n\r\n        - container: [dom element]\r\n            the dom element to contain the preview iframe\r\n        - htmlStr: [string]\r\n            print content html string\r\n        - cssJson: [json]\r\n            css to apply to the html for printing.\r\n            format: {[selecter]:{[css key]:[css value],[css key]:[css value], ...}, ...}\r\n\r\n            \r\n    $$.print.exec(name, htmlStr, cssJson)\r\n        * Print given content\r\n\r\n        -title: [string]\r\n            title of the print page\r\n        - htmlStr: [string]\r\n            print content html string\r\n        - cssJson: [json]\r\n            css to apply to the html for printing.\r\n            format: {[selecter]:{[css key]:[css value],[css key]:[css value], ...}, ...}\r\n            \r\n    $$.print.exec(name)\r\n        * Print preview content. Only work after preview and before clearing cache\r\n        \r\n        -title: [string]\r\n            title of the print page\r\n\r\n    $$.print.clear()\r\n        * Clear cache, including preview dom and reference to it\r\n\r\n\r\n************************************************/\r\n(function () {\r\n    \"use strict\";\r\n\r\n    // build style element\r\n    var _buildStyle = function (cssJson, doc) {\r\n        doc = doc || document;\r\n        var style = doc.createElement('style');\r\n        var styleStr = \"\";\r\n        style.type = 'text/css';\r\n\r\n        for (var itemName in cssJson) {\r\n            if (!cssJson.hasOwnProperty(itemName)) continue;\r\n            var cssItemStr = itemName + '{';\r\n            var cssItem = cssJson[itemName];\r\n            for (var i in cssItem) {\r\n                if (!cssItem.hasOwnProperty(i)) continue;\r\n                cssItemStr += i + ':' + cssItem[i] + ';';\r\n            }\r\n            cssItemStr += '}';\r\n            styleStr += cssItemStr;\r\n        }\r\n        if (style.styleSheet) style.styleSheet.cssText = styleStr;  // ie 7-8\r\n        else style.innerHTML = styleStr;                            // Others\r\n        return style;\r\n    };\r\n\r\n    // create an iframe\r\n    var _createIframe = function () {\r\n        var ifrm = document.createElement(\"iframe\");\r\n        ifrm.width = \"100%\";\r\n        ifrm.height = \"100%\";\r\n        ifrm.frameborder = \"0\";\r\n        ifrm.border = \"0\";\r\n        ifrm.style.width = \"100%\";\r\n        ifrm.style.height = \"100%\";\r\n        ifrm.style.position = \"absolute\";\r\n        ifrm.style.top = \"0\";\r\n        ifrm.style.left = \"0\";\r\n        ifrm.style.margin = \"0\";\r\n        ifrm.style.padding = \"0\";\r\n        ifrm.style.border = \"0\";\r\n        ifrm.style.overflow = \"auto\";\r\n        return ifrm;\r\n    };\r\n\r\n    // create print wrap\r\n    var _createPrintWrap = function () {\r\n        var iDiv = document.createElement('div');\r\n        iDiv.style.width = \"0\";\r\n        iDiv.style.height = \"0\";\r\n        iDiv.style.position = \"absolute\";\r\n        iDiv.style.bottom = \"0\";\r\n        iDiv.style.right = \"0\";\r\n        iDiv.style.overflow = \"hidden\";\r\n        return iDiv;\r\n    };\r\n\r\n    var _initPrint = function () {\r\n        var _printFrame;\r\n        var _printDoc;\r\n        var _loaded = false;\r\n        // show preview in given container\r\n        this.preview = function (container, opts, callback) {\r\n            try {\r\n                var htmlStr = opts.html;\r\n                var cssJson = opts.css;\r\n                var domain = opts.domain;\r\n\r\n                // create iframe\r\n                _printFrame = null;\r\n                _loaded = false;\r\n                var ifrm = _createIframe();\r\n                _printFrame = ifrm;\r\n                var onload = function () {\r\n                    //console.log('1');\r\n                    if (_loaded) return;\r\n                    if (callback) callback();\r\n                    _loaded = true;\r\n                };\r\n\r\n                if (ifrm.attachEvent) ifrm.attachEvent('onload', onload);\r\n                else ifrm.addEventListener('load', onload, false)\r\n\r\n                container.appendChild(ifrm);\r\n                if (domain != null) ifrm.src = _html[\"iframeSrcWithDomain\"].replace('#domain#', domain);\r\n                var doc = ifrm.contentWindow.document;\r\n                _printDoc = doc;\r\n                doc.open();\r\n                doc.write(htmlStr);\r\n                // css\r\n                doc.getElementsByTagName('head')[0].appendChild(_buildStyle(_css, doc));\r\n                if (cssJson !== null && cssJson !== undefined) {\r\n                    doc.getElementsByTagName('head')[0].appendChild(_buildStyle(cssJson, doc));\r\n                }\r\n                doc.close();\r\n            } catch (e) {\r\n                throw new Error(e);\r\n            }\r\n        };\r\n\r\n        // print\r\n        this.exec = function (opts, callback) {\r\n            var title = opts.title;\r\n            var htmlStr = opts.html;\r\n            var cssJson = opts.css;\r\n            var domain = opts.domain;\r\n\r\n            var printIframe = function () {\r\n                if (title !== null && title !== undefined) _printDoc.title = title;\r\n                if (!_printDoc.execCommand('print', false, null))\r\n                    _printFrame.contentWindow.print();\r\n                if (callback) callback();\r\n            };\r\n\r\n            try {\r\n                var _printWrap;\r\n                if (htmlStr !== null && htmlStr !== undefined) {\r\n                    _printWrap = _createPrintWrap();\r\n                    document.body.appendChild(_printWrap);\r\n                    this.preview(_printWrap, opts, function () {\r\n                        printIframe();\r\n                        document.body.removeChild(_printWrap);\r\n                    });\r\n                } else {\r\n                    if (_printDoc) {\r\n                        if (_loaded) printIframe();\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                throw new Error(e);\r\n            }\r\n        };\r\n\r\n        // clear preview panel and reference\r\n        this.clear = function () {\r\n            if (_printFrame) _printFrame.parentNode.removeChild(_printFrame);\r\n            _printFrame = null;\r\n            _loaded = false;\r\n        };\r\n    };\r\n\r\n    var _html = {\r\n        'iframeSrcWithDomain': \"javascript:document.write('<script>document.domain=\\\"#domain#\\\";</script>')\",\r\n        'printWrap': '<div style=\"width:0px;height:0px;position:absolute;top:0;right:0;overflow:hidden;margin:0;padding:0;border:0;\"></div>',\r\n        'style': '<style type=\"text/css\">#content#</style>'\r\n    };\r\n\r\n    var _css = {\r\n        'body': {\r\n            'margin': '0px',\r\n            'border': '0px',\r\n            'padding': '0px'\r\n        }\r\n    };\r\n\r\n    window.$$ = window.$$ || {};\r\n    window.$$.print = new _initPrint();\r\n})();"],"sourceRoot":"/source/"}